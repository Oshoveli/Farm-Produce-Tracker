<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports & Analytics - Farm Produce Tracker</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* FarmBot Styles */
        .farmbot-container {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
            margin: 40px 0;
        }

        .farmbot-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .farmbot-icon {
            font-size: 2rem;
            background: var(--primary-color);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .farmbot-chat {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            background: #f8f9fa;
        }

        .farmbot-message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 80%;
            line-height: 1.4;
        }

        .farmbot-message.user {
            background: var(--primary-color);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .farmbot-message.bot {
            background: var(--white);
            color: var(--text-dark);
            border: 1px solid #e2e8f0;
            border-bottom-left-radius: 4px;
            white-space: pre-line;
        }

        .farmbot-input {
            display: flex;
            gap: 10px;
        }

        .farmbot-input input {
            flex: 1;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .farmbot-input button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
        }

        .farmbot-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .farmbot-suggestion {
            background: var(--white);
            border: 1px solid #e2e8f0;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .farmbot-suggestion:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .report-actions {
            display: flex;
            gap: 10px;
        }

        .report-actions .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        .farmbot-tip {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 10px 15px;
            margin: 10px 0;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAiIGhlaWdodD0iMzAiIHZpZXdCb3g9IjAgMCAzMCAzMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE1IDI3LjVDMjEuOTAzNiAyNy41IDI3LjUgMjEuOTAzNiAyNy41IDE1QzI3LjUgOC4wOTY0NCAyMS45MDM2IDIuNSAxNSAyLjVDOC4wOTY0NCAyLjUgMi41IDguMDk2NDQgMi41IDE1QzIuNSAyMS45MDM2IDguMDk2NDQgMjcuNSAxNSAyNy41WiIgc3Ryb2tlPSIjM2NhMzc1IiBzdHJva2Utd2lkdGg9IjIiLz4KPHBhdGggZD0iTTEwIDEySDE5TTEwIDE3SDE2TTEwIDIySDE0IiBzdHJva2U9IiMzY2EzNzUiIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4K" alt="Farm Logo">
                <span>FarmTracker</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="dashboard.html" class="nav-link">Dashboard</a></li>
                <li class="nav-item"><a href="crops.html" class="nav-link">Crops</a></li>
                <li class="nav-item"><a href="livestock.html" class="nav-link">Livestock</a></li>
                <li class="nav-item"><a href="sales.html" class="nav-link">Sales</a></li>
                <li class="nav-item"><a href="reports.html" class="nav-link active">Reports</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="logout()">Logout</a></li>
            </ul>
        </div>
    </nav>

    <div class="page-content">
        <div class="container">
            <div class="dashboard-header">
                <h1>Farm Reports & Analytics</h1>
                <p>Comprehensive insights into your farm's performance</p>
            </div>

            <!-- FarmBot AI Assistant -->
            <div class="farmbot-container">
                <div class="farmbot-header">
                    <div class="farmbot-icon">ü§ñ</div>
                    <div>
                        <h3>FarmBot AI Assistant</h3>
                        <p>Get personalized farming advice and financial insights based on your data!</p>
                    </div>
                </div>
                <div class="farmbot-chat" id="farmbotChat">
                    <div class="farmbot-message bot">
                        üëã Hello! I'm FarmBot, your AI farming advisor. I can analyze your farm data and provide personalized advice on:\n\nüí∞ **Financial Performance** - Profit/loss analysis, revenue optimization\nüå± **Crop Management** - Yield improvements, planting strategies\nüêÑ **Livestock Health** - Animal care, breeding recommendations\nüìà **Business Growth** - Sales strategies, market opportunities\n\nWhat would you like to improve on your farm today?
                    </div>
                </div>
                <div class="farmbot-input">
                    <input type="text" id="farmbotInput" placeholder="Ask about profits, crop yields, livestock health, or business advice..." onkeypress="handleFarmBotKeypress(event)">
                    <button onclick="sendFarmBotMessage()">Send</button>
                </div>
                <div class="farmbot-suggestions">
                    <div class="farmbot-suggestion" onclick="askFarmBot('Am I making profit or loss? How can I improve?')">üí∞ Profit Analysis</div>
                    <div class="farmbot-suggestion" onclick="askFarmBot('Which crops are most profitable?')">üå± Crop Advice</div>
                    <div class="farmbot-suggestion" onclick="askFarmBot('How can I increase my livestock value?')">üêÑ Livestock Tips</div>
                    <div class="farmbot-suggestion" onclick="askFarmBot('What should I focus on to grow my farm business?')">üìà Growth Strategy</div>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="dashboard-cards">
                <div class="dashboard-card">
                    <h3>Total Inventory Value</h3>
                    <div class="value" id="totalInventoryValue">N$ 0</div>
                    <p>Current stock worth</p>
                </div>
                <div class="dashboard-card">
                    <h3>Monthly Revenue</h3>
                    <div class="value" id="monthlyRevenue">N$ 0</div>
                    <p>This month's income</p>
                </div>
                <div class="dashboard-card">
                    <h3>Active Crops</h3>
                    <div class="value" id="activeCropsCount">0</div>
                    <p>Different crop types</p>
                </div>
                <div class="dashboard-card">
                    <h3>Total Animals</h3>
                    <div class="value" id="totalAnimalsCount">0</div>
                    <p>Livestock count</p>
                </div>
            </div>

            <!-- Reports Grid -->
            <div class="features-grid" style="margin: 40px 0;">
                <div class="feature-card">
                    <div class="feature-icon">üìà</div>
                    <h3>Sales Trends</h3>
                    <p>View your sales performance over time and identify patterns</p>
                    <button class="btn btn-primary" onclick="generateSalesReport()">Generate Report</button>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üåæ</div>
                    <h3>Crop Analytics</h3>
                    <p>Analyze crop yields, planting cycles, and harvest data</p>
                    <button class="btn btn-primary" onclick="generateCropReport()">Generate Report</button>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üêÑ</div>
                    <h3>Livestock Reports</h3>
                    <p>Track animal health, growth, and production metrics</p>
                    <button class="btn btn-primary" onclick="generateLivestockReport()">Generate Report</button>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üí∞</div>
                    <h3>Financial Summary</h3>
                    <p>Comprehensive financial overview and profit analysis</p>
                    <button class="btn btn-primary" onclick="generateFinancialReport()">Generate Report</button>
                </div>
            </div>

            <!-- Recent Reports -->
            <div class="data-table">
                <h3>Recent Reports</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Report Type</th>
                            <th>Generated Date</th>
                            <th>Time Period</th>
                            <th>Summary</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="reportsTable">
                        <tr>
                            <td>Monthly Sales Summary</td>
                            <td>March 15, 2025</td>
                            <td>March 2025</td>
                            <td>Total sales: N$ 8,500 | Top product: Maize</td>
                            <td class="report-actions">
                                <button class="btn-small" onclick="viewReport('sales')">View</button> 
                                <button class="btn-small" onclick="downloadReport('sales')">Download</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Crop Inventory</td>
                            <td>March 10, 2025</td>
                            <td>Q1 2025</td>
                            <td>3 active crops | 800kg total inventory</td>
                            <td class="report-actions">
                                <button class="btn-small" onclick="viewReport('crop')">View</button> 
                                <button class="btn-small" onclick="downloadReport('crop')">Download</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Livestock Health</td>
                            <td>March 5, 2025</td>
                            <td>February 2025</td>
                            <td>75 animals | 92% healthy</td>
                            <td class="report-actions">
                                <button class="btn-small" onclick="viewReport('livestock')">View</button> 
                                <button class="btn-small" onclick="downloadReport('livestock')">Download</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Quick Stats -->
            <div class="data-table">
                <h3>Quick Statistics</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>This Month</th>
                            <th>Last Month</th>
                            <th>Change</th>
                        </tr>
                    </thead>
                    <tbody id="statsTable">
                        <!-- Stats will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Farm Produce Tracker. Empowering Namibian Farmers.</p>
        </div>
    </footer>

    <script src="js/scripts.js"></script>
    <script>
        // FarmBot AI Assistant Functions
        function sendFarmBotMessage() {
            const input = document.getElementById('farmbotInput');
            const message = input.value.trim();
            
            if (message) {
                addMessageToChat(message, 'user');
                input.value = '';
                
                // Simulate AI thinking
                setTimeout(() => {
                    const response = generateFarmBotResponse(message);
                    addMessageToChat(response, 'bot');
                }, 1000);
            }
        }

        function handleFarmBotKeypress(event) {
            if (event.key === 'Enter') {
                sendFarmBotMessage();
            }
        }

        function askFarmBot(question) {
            document.getElementById('farmbotInput').value = question;
            sendFarmBotMessage();
        }

        function addMessageToChat(message, sender) {
            const chat = document.getElementById('farmbotChat');
            const messageDiv = document.createElement('div');
            messageDiv.className = `farmbot-message ${sender}`;
            messageDiv.textContent = message;
            chat.appendChild(messageDiv);
            chat.scrollTop = chat.scrollHeight;
        }

        function generateFarmBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            const farmData = {
                crops: JSON.parse(localStorage.getItem('crops')) || [],
                livestock: JSON.parse(localStorage.getItem('livestock')) || [],
                sales: JSON.parse(localStorage.getItem('sales')) || []
            };

            // Financial Analysis & Profit Questions
            if (lowerMessage.includes('profit') || lowerMessage.includes('loss') || 
                lowerMessage.includes('financial') || lowerMessage.includes('revenue') || 
                lowerMessage.includes('make money') || lowerMessage.includes('income') ||
                lowerMessage.includes('improve') && lowerMessage.includes('financial')) {
                
                return generateFinancialAdvice(farmData);
            }

            // Crop Profitability & Management
            if ((lowerMessage.includes('crop') && lowerMessage.includes('profit')) || 
                lowerMessage.includes('which crop') || lowerMessage.includes('best crop') ||
                lowerMessage.includes('crop advice') || lowerMessage.includes('crop yield')) {
                
                return generateCropAdvice(farmData);
            }

            // Livestock Value & Management
            if (lowerMessage.includes('livestock') || lowerMessage.includes('animal') || 
                lowerMessage.includes('cattle') || lowerMessage.includes('goat') ||
                lowerMessage.includes('increase') && lowerMessage.includes('livestock')) {
                
                return generateLivestockAdvice(farmData);
            }

            // Business Growth & Strategy
            if (lowerMessage.includes('grow') || lowerMessage.includes('expand') || 
                lowerMessage.includes('business') || lowerMessage.includes('strategy') ||
                lowerMessage.includes('focus') || lowerMessage.includes('next step')) {
                
                return generateGrowthStrategy(farmData);
            }

            // Sales & Market Advice
            if (lowerMessage.includes('sale') || lowerMessage.includes('market') || 
                lowerMessage.includes('buyer') || lowerMessage.includes('price') ||
                lowerMessage.includes('sell more')) {
                
                return generateSalesAdvice(farmData);
            }

            // General farm performance
            if (lowerMessage.includes('how am i doing') || lowerMessage.includes('performance') ||
                lowerMessage.includes('overview') || lowerMessage.includes('summary')) {
                
                return generateFarmOverview(farmData);
            }

            // Help and capabilities
            if (lowerMessage.includes('help') || lowerMessage.includes('what can you do') || 
                lowerMessage.includes('capabilities')) {
                
                return `I'm FarmBot! Here's how I can help you:\n\nüí∞ **FINANCIAL ANALYSIS**\n- Profit/loss assessment\n- Revenue optimization tips\n- Cost management advice\n\nüå± **CROP MANAGEMENT**\n- Most profitable crop identification\n- Yield improvement strategies\n- Planting season advice\n\nüêÑ **LIVESTOCK OPTIMIZATION**\n- Animal value maximization\n- Health management tips\n- Breeding recommendations\n\nüìà **BUSINESS GROWTH**\n- Expansion opportunities\n- Market strategy advice\n- Resource allocation tips\n\nüí° **SALES & MARKETING**\n- Buyer relationship management\n- Pricing strategies\n- Sales channel optimization\n\nWhat specific area would you like to improve?`;
            }

            // Default response - try to be helpful
            return `I understand you're asking about "${message}". I specialize in providing farming business advice based on your actual data. \n\nYou can ask me about:\n- Your financial performance and how to improve profits\n- Which crops or livestock are most profitable\n- Strategies to grow your farm business\n- Sales and market opportunities\n\nWhat specific farming challenge can I help you with today?`;
        }

        function generateFinancialAdvice(farmData) {
            const totalSales = farmData.sales.reduce((sum, sale) => sum + parseFloat(sale.amount), 0);
            const totalCrops = farmData.crops.length;
            const totalLivestock = farmData.livestock.reduce((sum, animal) => sum + parseInt(animal.quantity), 0);
            const inventoryValue = calculateInventoryValue(farmData);
            
            let advice = `üí∞ **FINANCIAL ANALYSIS**\n\n`;
            
            // Basic assessment
            if (totalSales === 0) {
                advice += `üìä Current Status: Starting Phase\n- No sales recorded yet\n- Inventory value: N$ ${inventoryValue.toFixed(2)}\n- ${totalCrops} crop types, ${totalLivestock} animals\n\n`;
                advice += `üí° **RECOMMENDATIONS:**\n1. Start recording sales to track revenue\n2. Focus on selling your ${totalCrops > 0 ? 'crops' : 'livestock'}\n3. Build relationships with local buyers\n4. Consider diversifying your products`;
            } else {
                const monthlyAvg = totalSales / Math.max(farmData.sales.length, 1);
                const topProduct = getTopSellingProduct(farmData);
                
                advice += `üìä Current Performance:\n- Total Revenue: N$ ${totalSales.toFixed(2)}\n- Average per sale: N$ ${monthlyAvg.toFixed(2)}\n- Inventory Value: N$ ${inventoryValue.toFixed(2)}\n- Best Product: ${topProduct}\n\n`;
                
                // Growth recommendations
                advice += `üí° **PROFIT OPTIMIZATION:**\n`;
                
                if (monthlyAvg < 1000) {
                    advice += `1. **Increase Sales Volume**: Focus on ${topProduct} - your best performer\n`;
                }
                
                if (farmData.crops.length > 0) {
                    advice += `2. **Crop Rotation**: Consider seasonal crops for continuous revenue\n`;
                }
                
                if (farmData.livestock.length > 0) {
                    advice += `3. **Livestock Breeding**: Expand your animal herds for long-term growth\n`;
                }
                
                advice += `4. **Market Expansion**: Reach more buyers to increase sales frequency`;
            }
            
            return advice;
        }

        function generateCropAdvice(farmData) {
            if (farmData.crops.length === 0) {
                return `üå± **CROP MANAGEMENT**\n\nYou haven't added any crops yet. Here's how to get started:\n\n1. **Start with staple crops**: Maize and Mahangu have reliable markets\n2. **Consider seasonal varieties**: Plant different crops for year-round income\n3. **Track yields**: Record quantities to identify best performers\n4. **Monitor growth stages**: Update crop status for better planning\n\nWould you like advice on which crops to start with?`;
            }
            
            const crops = farmData.crops;
            const readyCrops = crops.filter(c => c.status === 'ready').length;
            const growingCrops = crops.filter(c => c.status === 'growing').length;
            const totalQuantity = crops.reduce((sum, crop) => sum + parseFloat(crop.quantity), 0);
            
            let advice = `üå± **CROP ANALYSIS**\n\n`;
            advice += `üìä Current Status:\n- ${crops.length} crop types\n- ${readyCrops} ready for harvest\n- ${growingCrops} still growing\n- Total quantity: ${totalQuantity}kg\n\n`;
            
            // Identify best performing crops
            const cropSales = analyzeCropSales(farmData);
            advice += `üèÜ **TOP PERFORMERS:**\n`;
            
            if (cropSales.length > 0) {
                cropSales.slice(0, 3).forEach(crop => {
                    advice += `- ${crop.name}: ${crop.sales} sales\n`;
                });
            } else {
                advice += `- Track sales to identify best-performing crops\n`;
            }
            
            advice += `\nüí° **OPTIMIZATION TIPS:**\n`;
            
            if (readyCrops > 0) {
                advice += `1. **Harvest & Sell**: ${readyCrops} crops are ready for market\n`;
            }
            
            if (growingCrops > 0) {
                advice += `2. **Monitor Growth**: ${growingCrops} crops need care until harvest\n`;
            }
            
            if (crops.length < 3) {
                advice += `3. **Diversify**: Add more crop types for risk management\n`;
            }
            
            advice += `4. **Record Sales**: Track which crops bring highest returns`;
            
            return advice;
        }

        function generateLivestockAdvice(farmData) {
            if (farmData.livestock.length === 0) {
                return `üêÑ **LIVESTOCK MANAGEMENT**\n\nNo livestock recorded yet. Here's how to start:\n\n1. **Begin with small animals**: Goats or chickens require less space\n2. **Consider local demand**: Focus on animals with good market prices\n3. **Health monitoring**: Track animal health from the start\n4. **Breeding planning**: Plan for herd growth over time\n\nNeed specific advice on which animals to start with?`;
            }
            
            const livestock = farmData.livestock;
            const totalAnimals = livestock.reduce((sum, animal) => sum + parseInt(animal.quantity), 0);
            const healthyAnimals = livestock.filter(a => a.healthStatus === 'healthy').length;
            const animalTypes = livestock.length;
            
            let advice = `üêÑ **LIVESTOCK ANALYSIS**\n\n`;
            advice += `üìä Current Status:\n- ${totalAnimals} total animals\n- ${animalTypes} different types\n- ${healthyAnimals}/${animalTypes} healthy herds\n\n`;
            
            advice += `üèÜ **YOUR HERD:**\n`;
            livestock.forEach(animal => {
                advice += `- ${animal.quantity} ${animal.type} (${animal.breed || 'mixed'}) - ${animal.healthStatus}\n`;
            });
            
            advice += `\nüí° **GROWTH STRATEGIES:**\n`;
            
            if (healthyAnimals === animalTypes) {
                advice += `1. **Excellent Health**: All herds are healthy - perfect for expansion\n`;
            } else {
                advice += `1. **Health Priority**: Address health issues in ${animalTypes - healthyAnimals} herd(s)\n`;
            }
            
            if (totalAnimals < 50) {
                advice += `2. **Herd Expansion**: Consider breeding to increase animal count\n`;
            }
            
            advice += `3. **Value Addition**: Explore products like milk, meat, or breeding stock\n`;
            advice += `4. **Market Research**: Identify best buyers for each animal type`;
            
            return advice;
        }

        function generateGrowthStrategy(farmData) {
            const totalSales = farmData.sales.reduce((sum, sale) => sum + parseFloat(sale.amount), 0);
            const cropCount = farmData.crops.length;
            const livestockCount = farmData.livestock.reduce((sum, animal) => sum + parseInt(animal.quantity), 0);
            
            let advice = `üìà **BUSINESS GROWTH STRATEGY**\n\n`;
            
            // Assess current position
            if (totalSales === 0) {
                advice += `üéØ **CURRENT STAGE**: Foundation Building\n\n`;
                advice += `üöÄ **IMMEDIATE FOCUS:**\n1. **Sales Generation**: Start recording your first sales\n2. **Market Entry**: Identify local buyers and markets\n3. **Product Validation**: Test which products sell best\n4. **Basic Tracking**: Continue using FarmTracker for data\n`;
            } else if (totalSales < 5000) {
                advice += `üéØ **CURRENT STAGE**: Early Growth\n\n`;
                advice += `üöÄ **SCALING STRATEGY:**\n1. **Product Focus**: Double down on your best-selling items\n2. **Customer Relationships**: Build repeat business with current buyers\n3. **Efficiency Improvement**: Optimize your farming processes\n4. **Modest Expansion**: Consider small increases in production\n`;
            } else {
                advice += `üéØ **CURRENT STAGE**: Established Business\n\n`;
                advice += `üöÄ **EXPANSION STRATEGY:**\n1. **Diversification**: Add complementary products/services\n2. **Market Expansion**: Reach new geographic areas\n3. **Value Addition**: Process raw products for higher margins\n4. **Technology Adoption**: Implement more advanced farming techniques\n`;
            }
            
            advice += `\nüìä **BASED ON YOUR DATA:**\n- ${cropCount} crop types | ${livestockCount} animals | N$ ${totalSales.toFixed(2)} revenue\n\n`;
            advice += `üí° **QUICK WINS:**\n${getQuickWins(farmData)}`;
            
            return advice;
        }

        function generateSalesAdvice(farmData) {
            const sales = farmData.sales;
            if (sales.length === 0) {
                return `üíº **SALES STRATEGY**\n\nNo sales recorded yet. Here's how to start selling:\n\n1. **Local Markets**: Start with farmers markets or local stores\n2. **Direct Sales**: Sell to neighbors and community members\n3. **Bulk Buyers**: Approach restaurants or grocery stores\n4. **Online Platforms**: Consider social media for local sales\n\nRemember to record every sale in FarmTracker to build your sales history!`;
            }
            
            const totalSales = sales.reduce((sum, sale) => sum + parseFloat(sale.amount), 0);
            const topBuyer = getTopBuyer(farmData);
            const bestProduct = getTopSellingProduct(farmData);
            
            let advice = `üíº **SALES PERFORMANCE ANALYSIS**\n\n`;
            advice += `üìä Current Metrics:\n- Total Sales: N$ ${totalSales.toFixed(2)}\n- Number of Transactions: ${sales.length}\n- Best Customer: ${topBuyer}\n- Top Product: ${bestProduct}\n\n`;
            
            advice += `üéØ **SALES OPTIMIZATION:**\n`;
            advice += `1. **Customer Retention**: Focus on ${topBuyer} - your best customer\n`;
            advice += `2. **Product Focus**: Promote ${bestProduct} - your top performer\n`;
            
            if (sales.length < 10) {
                advice += `3. **Sales Frequency**: Increase number of transactions\n`;
            }
            
            const avgSale = totalSales / sales.length;
            if (avgSale < 500) {
                advice += `4. **Average Order Value**: Bundle products to increase sale size\n`;
            }
            
            advice += `5. **New Customers**: Expand your buyer network for growth`;
            
            return advice;
        }

        function generateFarmOverview(farmData) {
            const totalSales = farmData.sales.reduce((sum, sale) => sum + parseFloat(sale.amount), 0);
            const cropCount = farmData.crops.length;
            const livestockCount = farmData.livestock.reduce((sum, animal) => sum + parseInt(animal.quantity), 0);
            const inventoryValue = calculateInventoryValue(farmData);
            
            let overview = `üèÜ **FARM PERFORMANCE OVERVIEW**\n\n`;
            overview += `üìà **KEY METRICS:**\n`;
            overview += `‚Ä¢ Total Revenue: N$ ${totalSales.toFixed(2)}\n`;
            overview += `‚Ä¢ Active Crops: ${cropCount} types\n`;
            overview += `‚Ä¢ Livestock: ${livestockCount} animals\n`;
            overview += `‚Ä¢ Inventory Value: N$ ${inventoryValue.toFixed(2)}\n`;
            overview += `‚Ä¢ Sales Transactions: ${farmData.sales.length}\n\n`;
            
            // Performance assessment
            if (totalSales === 0) {
                overview += `üéØ **STATUS**: Ready for First Sales\nüí° **NEXT STEP**: Record your first sale and start building revenue!`;
            } else if (totalSales < 3000) {
                overview += `üéØ **STATUS**: Growing Steadily\nüí° **NEXT STEP**: Focus on increasing sales frequency and average order value`;
            } else {
                overview += `üéØ **STATUS**: Well Established\nüí° **NEXT STEP**: Explore expansion opportunities and new markets`;
            }
            
            overview += `\n\nüåü **STRENGTHS:**\n${identifyStrengths(farmData)}`;
            overview += `\nüîß **AREAS FOR IMPROVEMENT:**\n${identifyImprovements(farmData)}`;
            
            return overview;
        }

        // Helper functions
        function calculateInventoryValue(farmData) {
            const cropValue = farmData.crops.reduce((sum, crop) => sum + (parseFloat(crop.quantity) * 10), 0);
            const livestockValue = farmData.livestock.reduce((sum, animal) => sum + (parseInt(animal.quantity) * 100), 0);
            return cropValue + livestockValue;
        }

        function getTopBuyer(farmData) {
            const buyerCounts = {};
            farmData.sales.forEach(sale => {
                buyerCounts[sale.buyer] = (buyerCounts[sale.buyer] || 0) + 1;
            });
            return Object.keys(buyerCounts).reduce((a, b) => buyerCounts[a] > buyerCounts[b] ? a : b, 'No frequent buyers yet');
        }

        function getTopSellingProduct(farmData) {
            const productSales = {};
            farmData.sales.forEach(sale => {
                productSales[sale.itemName] = (productSales[sale.itemName] || 0) + parseFloat(sale.amount);
            });
            return Object.keys(productSales).reduce((a, b) => productSales[a] > productSales[b] ? a : b, 'No products sold yet');
        }

        function analyzeCropSales(farmData) {
            const cropSales = [];
            farmData.crops.forEach(crop => {
                const sales = farmData.sales.filter(sale => sale.itemName === crop.name).length;
                cropSales.push({ name: crop.name, sales: sales });
            });
            return cropSales.sort((a, b) => b.sales - a.sales);
        }

        function getQuickWins(farmData) {
            const quickWins = [];
            
            if (farmData.crops.filter(c => c.status === 'ready').length > 0) {
                quickWins.push('‚Ä¢ Harvest and sell ready crops immediately');
            }
            
            if (farmData.sales.length === 0) {
                quickWins.push('‚Ä¢ Record your first sale to start revenue tracking');
            }
            
            if (farmData.livestock.filter(a => a.healthStatus !== 'healthy').length > 0) {
                quickWins.push('‚Ä¢ Address livestock health issues to maintain value');
            }
            
            if (farmData.crops.length < 2) {
                quickWins.push('‚Ä¢ Add one more crop type for diversification');
            }
            
            return quickWins.length > 0 ? quickWins.join('\n') : '‚Ä¢ Continue current successful practices';
        }

        function identifyStrengths(farmData) {
            const strengths = [];
            
            if (farmData.crops.length > 0) strengths.push('‚Ä¢ Multiple crop types for diversity');
            if (farmData.livestock.length > 0) strengths.push('‚Ä¢ Livestock assets for long-term value');
            if (farmData.sales.length > 5) strengths.push('‚Ä¢ Established sales history');
            if (calculateInventoryValue(farmData) > 1000) strengths.push('‚Ä¢ Significant inventory value');
            
            return strengths.length > 0 ? strengths.join('\n') : '‚Ä¢ Using FarmTracker for better management';
        }

        function identifyImprovements(farmData) {
            const improvements = [];
            
            if (farmData.sales.length === 0) improvements.push('‚Ä¢ Start recording sales transactions');
            if (farmData.crops.length === 0) improvements.push('‚Ä¢ Consider adding crop cultivation');
            if (farmData.livestock.length === 0) improvements.push('‚Ä¢ Explore livestock opportunities');
            if (farmData.sales.length > 0 && farmData.sales.length < 10) improvements.push('‚Ä¢ Increase sales frequency');
            
            return improvements.length > 0 ? improvements.join('\n') : '‚Ä¢ Continue optimizing current operations';
        }

        // Report View and Download Functions
        function viewReport(type) {
            switch(type) {
                case 'sales':
                    generateSalesReport();
                    showSuccess('Sales report opened in new window!');
                    break;
                case 'crop':
                    generateCropReport();
                    showSuccess('Crop report opened in new window!');
                    break;
                case 'livestock':
                    generateLivestockReport();
                    showSuccess('Livestock report opened in new window!');
                    break;
                default:
                    showError('Report type not recognized');
            }
        }

        function downloadReport(type) {
            switch(type) {
                case 'sales':
                    generateSalesReport();
                    break;
                case 'crop':
                    generateCropReport();
                    break;
                case 'livestock':
                    generateLivestockReport();
                    break;
                default:
                    showError('Report type not recognized');
            }
        }

        // Utility functions for showing messages
        function showSuccess(message) {
            alert('‚úÖ ' + message);
        }

        function showError(message) {
            alert('‚ùå ' + message);
        }
    </script>
</body>
</html>
