<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports & Analytics - Farm Produce Tracker</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* FarmBot Styles */
        .farmbot-container {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
            margin: 40px 0;
        }

        .farmbot-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .farmbot-icon {
            font-size: 2rem;
            background: var(--primary-color);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .farmbot-chat {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            background: #f8f9fa;
        }

        .farmbot-message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 80%;
            line-height: 1.4;
        }

        .farmbot-message.user {
            background: var(--primary-color);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .farmbot-message.bot {
            background: var(--white);
            color: var(--text-dark);
            border: 1px solid #e2e8f0;
            border-bottom-left-radius: 4px;
        }

        .farmbot-input {
            display: flex;
            gap: 10px;
        }

        .farmbot-input input {
            flex: 1;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .farmbot-input button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
        }

        .farmbot-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .farmbot-suggestion {
            background: var(--white);
            border: 1px solid #e2e8f0;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .farmbot-suggestion:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .report-actions {
            display: flex;
            gap: 10px;
        }

        .report-actions .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAiIGhlaWdodD0iMzAiIHZpZXdCb3g9IjAgMCAzMCAzMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE1IDI3LjVDMjEuOTAzNiAyNy41IDI3LjUgMjEuOTAzNiAyNy41IDE1QzI3LjUgOC4wOTY0NCAyMS45MDM2IDIuNSAxNSAyLjVDOC4wOTY0NCAyLjUgMi41IDguMDk2NDQgMi41IDE1QzIuNSAyMS45MDM2IDguMDk2NDQgMjcuNSAxNSAyNy41WiIgc3Ryb2tlPSIjM2NhMzc1IiBzdHJva2Utd2lkdGg9IjIiLz4KPHBhdGggZD0iTTEwIDEySDE5TTEwIDE3SDE2TTEwIDIySDE0IiBzdHJva2U9IiMzY2EzNzUiIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4K" alt="Farm Logo">
                <span>FarmTracker</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="dashboard.html" class="nav-link">Dashboard</a></li>
                <li class="nav-item"><a href="crops.html" class="nav-link">Crops</a></li>
                <li class="nav-item"><a href="livestock.html" class="nav-link">Livestock</a></li>
                <li class="nav-item"><a href="sales.html" class="nav-link">Sales</a></li>
                <li class="nav-item"><a href="reports.html" class="nav-link active">Reports</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="logout()">Logout</a></li>
            </ul>
        </div>
    </nav>

    <div class="page-content">
        <div class="container">
            <div class="dashboard-header">
                <h1>Farm Reports & Analytics</h1>
                <p>Comprehensive insights into your farm's performance</p>
            </div>

            <!-- FarmBot AI Assistant -->
            <div class="farmbot-container">
                <div class="farmbot-header">
                    <div class="farmbot-icon">ü§ñ</div>
                    <div>
                        <h3>FarmBot AI Assistant</h3>
                        <p>Ask me anything about your farm data, reports, or analytics!</p>
                    </div>
                </div>
                <div class="farmbot-chat" id="farmbotChat">
                    <div class="farmbot-message bot">
                        üëã Hello! I'm FarmBot, your AI farming assistant. I can help you understand your farm data, generate reports, and provide insights. What would you like to know?
                    </div>
                </div>
                <div class="farmbot-input">
                    <input type="text" id="farmbotInput" placeholder="Ask about your crops, livestock, sales, or reports..." onkeypress="handleFarmBotKeypress(event)">
                    <button onclick="sendFarmBotMessage()">Send</button>
                </div>
                <div class="farmbot-suggestions">
                    <div class="farmbot-suggestion" onclick="askFarmBot('How are my crops doing?')">üå± Crop Status</div>
                    <div class="farmbot-suggestion" onclick="askFarmBot('Show me livestock summary')">üêÑ Livestock Overview</div>
                    <div class="farmbot-suggestion" onclick="askFarmBot('What are my sales this month?')">üí∞ Monthly Sales</div>
                    <div class="farmbot-suggestion" onclick="askFarmBot('Generate financial report')">üìä Financial Report</div>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="dashboard-cards">
                <div class="dashboard-card">
                    <h3>Total Inventory Value</h3>
                    <div class="value" id="totalInventoryValue">N$ 0</div>
                    <p>Current stock worth</p>
                </div>
                <div class="dashboard-card">
                    <h3>Monthly Revenue</h3>
                    <div class="value" id="monthlyRevenue">N$ 0</div>
                    <p>This month's income</p>
                </div>
                <div class="dashboard-card">
                    <h3>Active Crops</h3>
                    <div class="value" id="activeCropsCount">0</div>
                    <p>Different crop types</p>
                </div>
                <div class="dashboard-card">
                    <h3>Total Animals</h3>
                    <div class="value" id="totalAnimalsCount">0</div>
                    <p>Livestock count</p>
                </div>
            </div>

            <!-- Reports Grid -->
            <div class="features-grid" style="margin: 40px 0;">
                <div class="feature-card">
                    <div class="feature-icon">üìà</div>
                    <h3>Sales Trends</h3>
                    <p>View your sales performance over time and identify patterns</p>
                    <button class="btn btn-primary" onclick="generateSalesReport()">Generate Report</button>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üåæ</div>
                    <h3>Crop Analytics</h3>
                    <p>Analyze crop yields, planting cycles, and harvest data</p>
                    <button class="btn btn-primary" onclick="generateCropReport()">Generate Report</button>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üêÑ</div>
                    <h3>Livestock Reports</h3>
                    <p>Track animal health, growth, and production metrics</p>
                    <button class="btn btn-primary" onclick="generateLivestockReport()">Generate Report</button>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üí∞</div>
                    <h3>Financial Summary</h3>
                    <p>Comprehensive financial overview and profit analysis</p>
                    <button class="btn btn-primary" onclick="generateFinancialReport()">Generate Report</button>
                </div>
            </div>

            <!-- Recent Reports -->
            <div class="data-table">
                <h3>Recent Reports</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Report Type</th>
                            <th>Generated Date</th>
                            <th>Time Period</th>
                            <th>Summary</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="reportsTable">
                        <tr>
                            <td>Monthly Sales Summary</td>
                            <td>March 15, 2025</td>
                            <td>March 2025</td>
                            <td>Total sales: N$ 8,500 | Top product: Maize</td>
                            <td class="report-actions">
                                <button class="btn-small" onclick="viewReport('sales')">View</button> 
                                <button class="btn-small" onclick="downloadReport('sales')">Download</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Crop Inventory</td>
                            <td>March 10, 2025</td>
                            <td>Q1 2025</td>
                            <td>3 active crops | 800kg total inventory</td>
                            <td class="report-actions">
                                <button class="btn-small" onclick="viewReport('crop')">View</button> 
                                <button class="btn-small" onclick="downloadReport('crop')">Download</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Livestock Health</td>
                            <td>March 5, 2025</td>
                            <td>February 2025</td>
                            <td>75 animals | 92% healthy</td>
                            <td class="report-actions">
                                <button class="btn-small" onclick="viewReport('livestock')">View</button> 
                                <button class="btn-small" onclick="downloadReport('livestock')">Download</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Quick Stats -->
            <div class="data-table">
                <h3>Quick Statistics</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>This Month</th>
                            <th>Last Month</th>
                            <th>Change</th>
                        </tr>
                    </thead>
                    <tbody id="statsTable">
                        <!-- Stats will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Farm Produce Tracker. Empowering Namibian Farmers.</p>
        </div>
    </footer>

    <script src="js/scripts.js"></script>
    <script>
        // FarmBot AI Assistant Functions
        function sendFarmBotMessage() {
            const input = document.getElementById('farmbotInput');
            const message = input.value.trim();
            
            if (message) {
                addMessageToChat(message, 'user');
                input.value = '';
                
                // Simulate AI thinking
                setTimeout(() => {
                    const response = generateFarmBotResponse(message);
                    addMessageToChat(response, 'bot');
                }, 1000);
            }
        }

        function handleFarmBotKeypress(event) {
            if (event.key === 'Enter') {
                sendFarmBotMessage();
            }
        }

        function askFarmBot(question) {
            document.getElementById('farmbotInput').value = question;
            sendFarmBotMessage();
        }

        function addMessageToChat(message, sender) {
            const chat = document.getElementById('farmbotChat');
            const messageDiv = document.createElement('div');
            messageDiv.className = `farmbot-message ${sender}`;
            messageDiv.textContent = message;
            chat.appendChild(messageDiv);
            chat.scrollTop = chat.scrollHeight;
        }

        function generateFarmBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            const farmData = {
                crops: JSON.parse(localStorage.getItem('crops')) || [],
                livestock: JSON.parse(localStorage.getItem('livestock')) || [],
                sales: JSON.parse(localStorage.getItem('sales')) || []
            };

            // Crop-related queries
            if (lowerMessage.includes('crop') || lowerMessage.includes('plant')) {
                const totalCrops = farmData.crops.length;
                const growingCrops = farmData.crops.filter(c => c.status === 'growing').length;
                const readyCrops = farmData.crops.filter(c => c.status === 'ready').length;
                const totalQuantity = farmData.crops.reduce((sum, crop) => sum + parseFloat(crop.quantity), 0);
                
                if (totalCrops === 0) {
                    return "You haven't added any crops yet. Start by adding your first crop in the Crops section!";
                }
                
                return `üå± You have ${totalCrops} crop types:\n- ${growingCrops} currently growing\n- ${readyCrops} ready for harvest\n- Total quantity: ${totalQuantity}kg\n\nTop crops: ${farmData.crops.slice(0, 3).map(c => c.name).join(', ')}`;
            }

            // Livestock-related queries
            if (lowerMessage.includes('livestock') || lowerMessage.includes('animal') || lowerMessage.includes('cattle') || lowerMessage.includes('goat')) {
                const totalAnimals = farmData.livestock.reduce((sum, animal) => sum + parseInt(animal.quantity), 0);
                const animalTypes = farmData.livestock.length;
                const healthyAnimals = farmData.livestock.filter(a => a.healthStatus === 'healthy').length;
                
                if (animalTypes === 0) {
                    return "You haven't added any livestock yet. Visit the Livestock section to add your animals!";
                }
                
                return `üêÑ Livestock Summary:\n- Total animals: ${totalAnimals}\n- Animal types: ${animalTypes}\n- Healthy herds: ${healthyAnimals}/${animalTypes}\n\nYour animals: ${farmData.livestock.map(a => `${a.quantity} ${a.type}`).join(', ')}`;
            }

            // Sales-related queries
            if (lowerMessage.includes('sale') || lowerMessage.includes('revenue') || lowerMessage.includes('income') || lowerMessage.includes('money')) {
                const totalSales = farmData.sales.reduce((sum, sale) => sum + parseFloat(sale.amount), 0);
                const thisMonth = new Date().getMonth();
                const monthlySales = farmData.sales
                    .filter(sale => new Date(sale.date).getMonth() === thisMonth)
                    .reduce((sum, sale) => sum + parseFloat(sale.amount), 0);
                
                if (farmData.sales.length === 0) {
                    return "No sales recorded yet. Start recording your sales in the Sales section to track your revenue!";
                }
                
                return `üí∞ Sales Overview:\n- Total revenue: N$ ${totalSales.toFixed(2)}\n- This month: N$ ${monthlySales.toFixed(2)}\n- Total transactions: ${farmData.sales.length}\n\nTop buyer: ${getTopBuyer()}`;
            }

            // Report-related queries
            if (lowerMessage.includes('report') || lowerMessage.includes('analytics') || lowerMessage.includes('summary')) {
                if (lowerMessage.includes('financial') || lowerMessage.includes('money')) {
                    generateFinancialReport();
                    return "I've generated a comprehensive financial report for you! Check your downloads for the detailed analysis. üìä";
                } else if (lowerMessage.includes('crop')) {
                    generateCropReport();
                    return "Your crop analytics report is ready! Download it to see detailed insights about your crops. üåæ";
                } else if (lowerMessage.includes('livestock')) {
                    generateLivestockReport();
                    return "Livestock health report generated! You can now review your animals' status and metrics. üêÑ";
                } else if (lowerMessage.includes('sale')) {
                    generateSalesReport();
                    return "Sales trends report created! It includes your revenue patterns and buyer information. üìà";
                } else {
                    return "I can generate several reports for you:\n- üìä Financial Summary\n- üåæ Crop Analytics\n- üêÑ Livestock Health\n- üìà Sales Trends\n\nJust tell me which one you'd like, or click the buttons above!";
                }
            }

            // Inventory queries
            if (lowerMessage.includes('inventory') || lowerMessage.includes('stock')) {
                const cropValue = farmData.crops.reduce((sum, crop) => sum + (parseFloat(crop.quantity) * 10), 0);
                const livestockValue = farmData.livestock.reduce((sum, animal) => sum + (parseInt(animal.quantity) * 100), 0);
                const totalValue = cropValue + livestockValue;
                
                return `üì¶ Inventory Value:\n- Crop inventory: N$ ${cropValue.toFixed(2)}\n- Livestock inventory: N$ ${livestockValue.toFixed(2)}\n- Total value: N$ ${totalValue.toFixed(2)}\n\nThis represents your current farm assets worth!`;
            }

            // General help
            if (lowerMessage.includes('help') || lowerMessage.includes('what can you do')) {
                return `I'm FarmBot! Here's what I can help you with:\n\nüå± **Crop Management** - Check crop status, quantities, and growth\nüêÑ **Livestock Tracking** - Animal counts, health status, breeds\nüí∞ **Sales & Revenue** - Income tracking, monthly reports\nüìä **Reports & Analytics** - Generate detailed farm reports\nüì¶ **Inventory Value** - Total worth of your farm assets\n\nJust ask me anything about your farm data!`;
            }

            // Default response
            return "I'm here to help with your farm data! You can ask me about:\n- Your crops and their status üå±\n- Livestock information üêÑ\n- Sales and revenue üí∞\n- Generating reports üìä\n- Farm inventory value üì¶\n\nWhat would you like to know?";
        }

        function getTopBuyer() {
            const farmData = {
                sales: JSON.parse(localStorage.getItem('sales')) || []
            };
            
            const buyerCounts = {};
            farmData.sales.forEach(sale => {
                buyerCounts[sale.buyer] = (buyerCounts[sale.buyer] || 0) + parseFloat(sale.amount);
            });
            
            const topBuyer = Object.keys(buyerCounts).reduce((a, b) => 
                buyerCounts[a] > buyerCounts[b] ? a : b, 'No buyers yet'
            );
            
            return topBuyer;
        }

        // Report View and Download Functions
        function viewReport(type) {
            switch(type) {
                case 'sales':
                    generateSalesReport();
                    showSuccess('Sales report opened in new window!');
                    break;
                case 'crop':
                    generateCropReport();
                    showSuccess('Crop report opened in new window!');
                    break;
                case 'livestock':
                    generateLivestockReport();
                    showSuccess('Livestock report opened in new window!');
                    break;
                default:
                    showError('Report type not recognized');
            }
        }

        function downloadReport(type) {
            switch(type) {
                case 'sales':
                    generateSalesReport();
                    break;
                case 'crop':
                    generateCropReport();
                    break;
                case 'livestock':
                    generateLivestockReport();
                    break;
                default:
                    showError('Report type not recognized');
            }
        }

        // Utility functions for showing messages
        function showSuccess(message) {
            alert('‚úÖ ' + message);
        }

        function showError(message) {
            alert('‚ùå ' + message);
        }
    </script>
</body>
</html>
